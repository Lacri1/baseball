apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: baseball-ingress
  namespace: baseball-app
  annotations:
    kubernetes.io/ingress.class: alb # AWS Load Balancer Controller 사용
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS":443}]'
    alb.ingress.kubernetes.io/actions.ssl-redirect: '{"Type": "redirect", "RedirectConfig": { "Protocol": "HTTPS", "Port": "443", "StatusCode": "HTTP_301" }}'
    # alb.ingress.kubernetes.io/certificate-arn: <YOUR_ACM_CERTIFICATE_ARN> # HTTPS 사용 시 ACM 인증서 ARN 지정
    # alb.ingress.kubernetes.io/ssl-redirect: '443'
spec:
  rules:
  - http:
      paths:
      - path: / # 모든 경로를 프론트엔드로 라우팅
        pathType: Prefix
        backend:
          service:
            name: ssl-redirect # HTTP를 HTTPS로 리다이렉트하는 서비스 (아래에서 정의)
            port:
              name: use-annotation
  - http:
      paths:
      - path: /api # /api 경로는 백엔드로 라우팅
        pathType: Prefix
        backend:
          service:
            name: backend-service
            port:
              number: 8080
      - path: / # 모든 경로를 프론트엔드로 라우팅
        pathType: Prefix
        backend:
          service:
            name: frontend-service
            port:
              number: 80
  # HTTP를 HTTPS로 리다이렉트하는 서비스 정의 (Ingress Annotation과 함께 사용)
  defaultBackend:
    service:
      name: frontend-service
      port:
        number: 80
