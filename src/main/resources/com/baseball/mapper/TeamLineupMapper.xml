<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baseball.game.mapper.TeamLineupMapper">

    <resultMap id="batterResultMap" type="com.baseball.game.dto.Batter">
        <id property="no" column="No"/>
        <result property="name" column="Player_Name"/>
        <result property="team" column="Player_Team"/>
        <result property="battingAverage" column="Batting_average"/>
        <result property="gameNum" column="Game_Num"/>
        <result property="plateAppearances" column="Plate_Appearance"/>
        <result property="atBats" column="At_Bat"/>
        <result property="run" column="Run"/>
        <result property="hits" column="Hit"/>
        <result property="twoBases" column="two_Base"/>
        <result property="threeBases" column="three_Base"/>
        <result property="homeRuns" column="Home_Run"/>
        <result property="totalBases" column="Total_Base"/>
        <result property="runsBattedIn" column="Runs_Batted_In"/>
        <result property="sacrificeBunts" column="Sacrifice_Bunts"/>
        <result property="sacrificeFly" column="Sacrifice_Fly"/>
        <result property="fourBall" column="Four_Ball"/>
        <result property="ibb" column="IBB"/>
        <result property="hitByPitch" column="Hit_by_Pitch"/>
        <result property="strikeOut" column="Strike_Out"/>
        <result property="doubleOut" column="Double_out"/>
        <result property="slugging" column="Slugging"/>
        <result property="onBasePercentage" column="On_Base_Percentage"/>
        <result property="onbasePlusSlug" column="Onbase_Plus_Slug"/>
        <result property="multiHit" column="Multi_Hit"/>
        <result property="scoringPositionAvg" column="Scoring_Position_AVG"/>
        <result property="pinchHitAvg" column="Pinch_Hit_AVG"/>
    </resultMap>

    <resultMap id="pitcherResultMap" type="com.baseball.game.dto.Pitcher">
        <id property="no" column="No"/>
        <result property="name" column="Player_Name"/>
        <result property="team" column="Player_Team"/>
        <result property="earnedRunAverage" column="Earned_Run_Average"/>
        <result property="gameNum" column="Game_Num"/>
        <result property="win" column="Win"/>
        <result property="lose" column="Lose"/>
        <result property="save" column="Save"/>
        <result property="hold" column="Hold"/>
        <result property="winningPercentage" column="Winning_Percentage"/>
        <result property="inningsPitched" column="Innings_Pitched"/>
        <result property="hits" column="Hits"/>
        <result property="homeRun" column="Home_Run"/>
        <result property="baseOnBalls" column="Base_On_Balls"/>
        <result property="hitByPitch" column="Hit_By_Pitch"/>
        <result property="strikeOut" column="Strike_Out"/>
        <result property="runs" column="Runs"/>
        <result property="earnedRun" column="Earned_Run"/>
        <result property="whip" column="WHIP"/>
        <result property="completeGame" column="Complete_Game"/>
        <result property="shutout" column="Shutout"/>
        <result property="qualityStart" column="Quality_Start"/>
        <result property="blownSave" column="Blown_Save"/>
        <result property="totalBattersFaced" column="Total_Batters_Faced"/>
        <result property="numberOfPitching" column="Number_Of_Pitching"/>
        <result property="opponentBattingAverage" column="Opponent_Batting_Average"/>
        <result property="twoBases" column="two_Base"/>
        <result property="threeBases" column="three_Base"/>
        <result property="sacrificeBunt" column="Sacrifice_Bunt"/>
        <result property="sacrificeFly" column="Sacrifice_Fly"/>
        <result property="ibb" column="IBB"/>
        <result property="wildPitch" column="Wild_Pitch"/>
        <result property="balk" column="Balk"/>
    </resultMap>

    <!-- 팀별 사용 가능한 선수 목록 조회 (이름만) -->
    <select id="findAvailablePlayersByTeamBatters" resultType="String">
        <![CDATA[
        SELECT Player_Name FROM kbo_hitter_stats_2024
        WHERE Player_Team = #{teamName} and Game_Num > 30 
ORDER BY Player_Name
        ]]>
    </select>
    
    <select id="findAvailablePlayersByTeamPitchers" resultType="String">
        <![CDATA[
        SELECT Player_Name FROM kbo_pitcher_stats_2024
        WHERE Player_Team = #{teamName} and Innings_Pitched > 20 
ORDER BY Player_Name
        ]]>
    </select>
    
    <!-- 팀별 사용 가능한 타자 성적 데이터 조회 -->
    <select id="findAvailableBattersByTeam" resultMap="batterResultMap">
        <![CDATA[
        SELECT
            No,
            Player_Name,
            Player_Team,
            Batting_average,
            Game_Num,
            Plate_Appearance,
            At_Bat,
            Run,
            Hit,
            two_Base,
            three_Base,
            Home_Run,
            Total_Base,
            Runs_Batted_In,
            Sacrifice_Bunts,
            Sacrifice_Fly,
            Four_Ball,
            IBB,
            Hit_by_Pitch,
            Strike_Out,
            Double_out,
            Slugging,
            On_Base_Percentage,
            Onbase_Plus_Slug,
            Multi_Hit,
            Scoring_Position_AVG,
            Pinch_Hit_AVG
        FROM kbo_hitter_stats_2024
        WHERE Player_Team = #{teamName} and Game_Num > 30
        ORDER BY Player_Name
        ]]>
    </select>
    
    <!-- 팀별 사용 가능한 투수 성적 데이터 조회 -->
    <select id="findAvailablePitchersByTeam" resultMap="pitcherResultMap">
        <![CDATA[
        SELECT
            No,
            Player_Name,
            Player_Team,
            Earned_Run_Average,
            Game_Num,
            Win,
            Lose,
            Save,
            Hold,
            Winning_Percentage,
            Innings_Pitched,
            Hits,
            Home_Run,
            Base_On_Balls,
            Hit_By_Pitch,
            Strike_Out,
            Runs,
            Earned_Run,
            WHIP,
            Complete_Game,
            Shutout,
            Quality_Start,
            Blown_Save,
            Total_Batters_Faced,
            Number_Of_Pitching,
            Opponent_Batting_Average,
            two_Base,
            three_Base,
            Sacrifice_Bunt,
            Sacrifice_Fly,
            IBB,
            Wild_Pitch,
            Balk
        FROM kbo_pitcher_stats_2024
        WHERE Player_Team = #{teamName} and Innings_Pitched > 20
        ORDER BY Player_Name
        ]]>
    </select>

    <!-- 모든 타자 성적 데이터 조회 -->
    <select id="findAllBatters" resultMap="batterResultMap">
        SELECT
            No,
            Player_Name,
            Player_Team,
            Batting_average,
            Game_Num,
            Plate_Appearance,
            0 AS At_Bat,
            Run,
            Hit,
            two_Base,
            three_Base,
            Home_Run,
            0 AS Total_Base,
            Runs_Batted_In,
            0 AS Sacrifice_Bunts,
            0 AS Sacrifice_Fly,
            Four_Ball,
            0 AS IBB,
            0 AS Hit_by_Pitch,
            Strike_Out,
            0 AS Double_out,
            0.0 AS Slugging,
            On_Base_Percentage,
            Onbase_Plus_Slug,
            0 AS Multi_Hit,
            0.0 AS Scoring_Position_AVG,
            0.0 AS Pinch_Hit_AVG
        FROM kbo_hitter_stats_2025
        <if test="sortBy != null and sortBy != ''">
            <choose>
                <when test="sortBy == 'run'">ORDER BY Run DESC</when>
                <when test="sortBy == 'hits'">ORDER BY Hit DESC</when>
                <when test="sortBy == 'homeRun'">ORDER BY Home_Run DESC</when>
                <when test="sortBy == 'avg'">ORDER BY Batting_average DESC</when>
                <otherwise>ORDER BY Player_Name ASC</otherwise>
            </choose>
        </if>
        <if test="sortBy == null or sortBy == ''">
            ORDER BY Player_Name ASC
        </if>
    </select>

    <!-- 모든 투수 성적 데이터 조회 -->
    <select id="findAllPitchers" resultMap="pitcherResultMap">
        SELECT
            No,
            Player_Name,
            Player_Team,
            Earned_Run_Average,
            Game_Num,
            Win,
            Lose,
            Save,
            Hold,
            0.0 AS Winning_Percentage,
            Innings_Pitched,
            Hits,
            Home_Run,
            Base_On_Balls,
            0 AS Hit_By_Pitch,
            Strike_Out,
            Runs,
            Earned_Run,
            WHIP,
            0 AS Complete_Game,
            0 AS Shutout,
            0 AS Quality_Start,
            0 AS Blown_Save,
            0 AS Total_Batters_Faced,
            0 AS Number_Of_Pitching,
            0.0 AS Opponent_Batting_Average,
            0 AS two_Base,
            0 AS three_Base,
            0 AS Sacrifice_Bunt,
            0 AS Sacrifice_Fly,
            0 AS IBB,
            0 AS Wild_Pitch,
            0 AS Balk
        FROM kbo_pitcher_stats_2025
        <if test="sortBy != null and sortBy != ''">
            <choose>
                <when test="sortBy == 'era'">ORDER BY Earned_Run_Average ASC</when>
                <when test="sortBy == 'win'">ORDER BY Win DESC</when>
                <when test="sortBy == 'save'">ORDER BY Save DESC</when>
                <otherwise>ORDER BY Player_Name ASC</otherwise>
            </choose>
        </if>
        <if test="sortBy == null or sortBy == ''">
            ORDER BY Player_Name ASC
        </if>
    </select>
    
</mapper>